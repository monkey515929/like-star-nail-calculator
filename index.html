<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8" />
<title>Like STar Nail 計算機</title>
<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  background: #f7f7f7;
  padding: 20px;
}
h1 { text-align: center; }

button {
  padding: 6px 10px;
  margin: 2px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 15px;
  margin-bottom: 16px;
}

.item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin: 6px 0;
}

.qty button {
  width: 28px;
}

textarea {
  width: 100%;
  height: 220px;
}

.drag {
  cursor: grab;
  opacity: 0.9;
}
.dragging {
  opacity: 0.4;
}
</style>
</head>

<body>

<h1>Like STar Nail</h1>

<!-- 前台 -->
<div class="card">
  <h3>服務項目</h3>
  <div id="frontItems"></div>
</div>

<div class="card">
  <label>訂金：</label>
  <select id="deposit">
    <option value="0">無</option>
    <option value="500">500</option>
    <option value="1000">1000</option>
  </select>
</div>

<div class="card">
  <h3>結帳明細</h3>
  <textarea id="summary" readonly></textarea>
  <button onclick="copySummary()">一鍵複製明細</button>
</div>

<div class="card">
  <button onclick="openBackend()">進入後台</button>
</div>

<script>
let items = JSON.parse(localStorage.getItem("items")) || [
  { name: "單色凝膠", price: 800, qty: 0 },
  { name: "鏡面(單指)", price: 120, qty: 0 },
  { name: "立體造型/異材質(單指)", price: 100, qty: 0 },
  { name: "延甲(單指)", price: 100, qty: 0 }
];

function save() {
  localStorage.setItem("items", JSON.stringify(items));
}

function renderFront() {
  const box = document.getElementById("frontItems");
  box.innerHTML = "";
  items.forEach((it, i) => {
    const div = document.createElement("div");
    div.className = "item";
    div.innerHTML = `
      <span>${it.name} $${it.price}</span>
      <div class="qty">
        <button onclick="changeQty(${i},-1)">-</button>
        ${it.qty}
        <button onclick="changeQty(${i},1)">+</button>
      </div>
    `;
    box.appendChild(div);
  });
  updateSummary();
}

function changeQty(i, n) {
  items[i].qty = Math.max(0, items[i].qty + n);
  save();
  renderFront();
}

function updateSummary() {
  let total = 0;
  let lines = [];
  items.forEach(it => {
    if (it.qty > 0) {
      const sum = it.qty * it.price;
      total += sum;
      lines.push(`${it.name} x${it.qty} : $${sum}`);
    }
  });

  const deposit = Number(document.getElementById("deposit").value);
  const pay = total - deposit;

  document.getElementById("summary").value =
`✨ Like STar Nail 結帳明細 ✨
--------------------------
${lines.join("\n")}
--------------------------
總計金額: $${total}
已付定金: -$${deposit}
現場應付: $${pay}
--------------------------
期待下次為您服務！`;
}

document.getElementById("deposit").onchange = updateSummary;

function copySummary() {
  navigator.clipboard.writeText(document.getElementById("summary").value);
  alert("已複製明細");
}

function openBackend() {
  window.location.href = "#backend";
  renderBackend();
}
</script>

<!-- 後台 -->
<div id="backend" class="card">
  <h3>後台管理（可拖曳排序）</h3>
  <div id="backendItems"></div>
  <button onclick="location.href='index.html'">回前台</button>
</div>

<script>
function renderBackend() {
  const box = document.getElementById("backendItems");
  box.innerHTML = "";

  items.forEach((it, i) => {
    const div = document.createElement("div");
    div.className = "item drag";
    div.draggable = true;
    div.innerHTML = `
      ☰ 
      <input value="${it.name}" onchange="items[${i}].name=this.value;save();renderFront()">
      <input type="number" value="${it.price}" style="width:80px"
        onchange="items[${i}].price=Number(this.value);save();renderFront()">
    `;

    div.addEventListener("dragstart", e => {
      div.classList.add("dragging");
      e.dataTransfer.setData("text/plain", i);
    });

    div.addEventListener("dragend", () => {
      div.classList.remove("dragging");
    });

    div.addEventListener("dragover", e => e.preventDefault());

    div.addEventListener("drop", e => {
      e.preventDefault();
      const from = Number(e.dataTransfer.getData("text/plain"));
      const temp = items[from];
      items.splice(from, 1);
      items.splice(i, 0, temp);
      save();
      renderBackend();
      renderFront();
    });

    box.appendChild(div);
  });
}

renderFront();
</script>

</body>
</html>