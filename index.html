<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>Like STar nail｜美甲計算機</title>
<script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

<style>
body{
  font-family:-apple-system,BlinkMacSystemFont;
  background:#f6f4f2;
  padding:20px;
}
h1{text-align:center;margin:5px 0 15px}
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
}
button{
  border:none;
  border-radius:10px;
  padding:6px 10px;
}
.section{
  background:#fff;
  border-radius:16px;
  padding:15px;
  margin-bottom:18px;
}
.item{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:8px;
}
.name{flex:2}
.price{font-size:13px;opacity:.7}
.qty{
  display:flex;
  align-items:center;
  gap:6px;
}
.qty button{
  width:28px;height:28px;
  border-radius:50%;
  background:#000;
  color:#fff;
}
.backend{
  background:#f0f0f0;
  padding:8px;
  border-radius:10px;
  margin-top:6px;
}
.backend input{
  width:100%;
  margin-bottom:4px;
}
.total{
  font-size:18px;
  text-align:right;
  font-weight:bold;
}
textarea{width:100%;height:90px}
.hidden{display:none}
</style>
</head>

<body>

<div class="topbar">
  <div></div>
  <button onclick="toggleBackend()">⚙️ 後台管理</button>
</div>

<h1>Like STar nail</h1>

<div id="app"></div>

<div class="section">
  <h3>訂金</h3>
  <button onclick="setDeposit(0)">不扣</button>
  <button onclick="setDeposit(500)">500</button>
  <button onclick="setDeposit(1000)">1000</button>
</div>

<div class="section">
  <h3>備註 / 傳 LINE 給客人</h3>
  <textarea id="note"></textarea>
  <button onclick="copyLine()">複製明細</button>
</div>

<div class="section total">
  總金額：$<span id="total">0</span>
</div>

<script>
let deposit=0;
let showBackend=false;

const data=[
{title:'基本款 / 套餐',items:[
{name:'單色凝膠（跳色+100/色）',price:800,qty:0},
{name:'貓眼（跳色+100/色）',price:1000,qty:0},
{name:'貓眼特殊吸法（玻璃珠、追光、法式等）',price:1200,qty:0},
{name:'鏡面、亮片、漸層、法式（足部+200）',price:1200,qty:0},
]},
{title:'加價單指',items:[
{name:'鏡面',price:120,qty:0},
{name:'手繪',price:50,qty:0},
{name:'量染',price:100,qty:0},
{name:'立體造型、異材質',price:100,qty:0},
{name:'配飾、鑽飾',price:50,qty:0},
{name:'延甲',price:100,qty:0},
]},
{title:'卸甲',items:[
{name:'本店卸甲續作、純卸',price:300,qty:0},
{name:'他店卸甲續作',price:400,qty:0},
{name:'他店純卸',price:500,qty:0},
{name:'純卸＋基礎保養',price:800,qty:0},
]}
];

function render(){
 const app=document.getElementById('app');
 app.innerHTML='';
 data.forEach((sec,s)=>{
  const box=document.createElement('div');
  box.className='section';
  box.innerHTML=`<h3>${sec.title}</h3>`;
  const list=document.createElement('div');
  list.id='list'+s;
  sec.items.forEach((it,i)=>{
    const row=document.createElement('div');
    row.className='item';
    row.innerHTML=`
      <div class="name">${it.name}<div class="price">$${it.price}</div></div>
      <div class="qty">
        <button onclick="chg(${s},${i},-1)">−</button>
        <span>${it.qty}</span>
        <button onclick="chg(${s},${i},1)">＋</button>
      </div>
      <div class="backend ${showBackend?'':'hidden'}">
        <input value="${it.name}" oninput="itName(${s},${i},this.value)">
        <input type="number" value="${it.price}" oninput="itPrice(${s},${i},this.value)">
        <button onclick="del(${s},${i})">刪除</button>
      </div>
    `;
    list.appendChild(row);
  });
  box.appendChild(list);
  if(showBackend){
    const add=document.createElement('button');
    add.textContent='＋新增項目';
    add.onclick=()=>addItem(s);
    box.appendChild(add);
    new Sortable(list,{animation:150});
  }
  app.appendChild(box);
 });
 calc();
}

function chg(s,i,v){
 data[s].items[i].qty=Math.max(0,data[s].items[i].qty+v);
 render();
}
function itName(s,i,v){data[s].items[i].name=v}
function itPrice(s,i,v){data[s].items[i].price=+v;calc()}
function del(s,i){data[s].items.splice(i,1);render()}
function addItem(s){
 data[s].items.push({name:'新項目',price:0,qty:0});
 render();
}
function toggleBackend(){
 showBackend=!showBackend;
 render();
}
function calc(){
 let sum=0;
 data.forEach(sec=>sec.items.forEach(it=>sum+=it.price*it.qty));
 document.getElementById('total').innerText=sum-deposit;
}
function setDeposit(v){deposit=v;calc()}
function copyLine(){
 let t='Like STar nail 美甲明細\n';
 data.forEach(sec=>sec.items.forEach(it=>{
  if(it.qty>0)t+=`${it.name} x${it.qty} $${it.price*it.qty}\n`;
 }));
 if(deposit>0)t+=`訂金扣除：$${deposit}\n`;
 t+=`總金額：$${document.getElementById('total').innerText}\n`;
 t+=`備註：${note.value}`;
 navigator.clipboard.writeText(t);
 alert('已複製');
}

render();
</script>

</body>
</html>