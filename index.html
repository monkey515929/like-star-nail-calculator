<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>Like STar nail 計算機</title>

<style>
body{
  background:#0f0f0f;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Noto Sans TC",sans-serif;
  padding:20px;
}
h1{text-align:center;font-weight:500;}
.section{
  background:#1a1a1a;
  padding:15px;
  border-radius:14px;
  margin-bottom:18px;
}
.section h3{
  border-left:4px solid #cfae70;
  padding-left:8px;
  margin-bottom:10px;
}
.item{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:8px;
}
.item span.name{flex:1}
button{
  background:#cfae70;
  color:#000;
  border:none;
  border-radius:6px;
  padding:4px 8px;
}
.qty{width:26px;text-align:center;}
select,textarea,input{
  width:100%;
  border-radius:6px;
  padding:6px;
  border:none;
}
pre{white-space:pre-wrap;line-height:1.6;}
.admin-item{
  background:#111;
  padding:8px;
  border-radius:8px;
  margin-bottom:6px;
  cursor:grab;
}
.admin-item.dragging{opacity:.4}
.small{font-size:13px;opacity:.7}
</style>
</head>

<body>

<h1>Like STar nail</h1>

<div id="app"></div>

<div class="section">
  <h3>訂金</h3>
  <select id="deposit" onchange="render()">
    <option value="0">未收訂金</option>
    <option value="500">已收訂金 $500</option>
    <option value="1000">已收訂金 $1000</option>
  </select>
</div>

<div class="section">
  <h3>備註（給客人）</h3>
  <textarea id="note" placeholder="保固 / 注意事項 / 下次預約"></textarea>
</div>

<div class="section">
  <h3>明細</h3>
  <pre id="detail"></pre>
  <button onclick="sendLine()">傳 LINE 給客人</button>
</div>

<div class="section">
  <h3>後台管理（拖移排序）</h3>

  <input id="newName" placeholder="項目名稱">
  <input id="newPrice" type="number" placeholder="金額（扣除請填負數）">
  <select id="newGroup">
    <option>基礎款</option>
    <option>單指加價</option>
    <option>卸甲</option>
    <option>扣除項目</option>
  </select>
  <button onclick="addItem()">新增項目</button>

  <div id="adminList"></div>
</div>

<script>
let items=[
  {name:"單色凝膠",price:800,group:"基礎款",qty:0},
  {name:"貓眼",price:1000,group:"基礎款",qty:0},
  {name:"貓眼特殊吸法",price:1200,group:"基礎款",qty:0},
  {name:"鏡面／亮片／漸層／法式",price:1200,group:"基礎款",qty:0},

  {name:"手繪",price:100,group:"單指加價",qty:0},
  {name:"暈染",price:100,group:"單指加價",qty:0},
  {name:"立體造型／異材質",price:100,group:"單指加價",qty:0},
  {name:"延甲",price:100,group:"單指加價",qty:0},

  {name:"本店卸甲續作",price:300,group:"卸甲",qty:0},
  {name:"他店卸甲續作",price:400,group:"卸甲",qty:0},

  {name:"扣除基本單色",price:-800,group:"扣除項目",qty:0}
];

function render(){
  const app=document.getElementById("app");
  const admin=document.getElementById("adminList");
  app.innerHTML="";
  admin.innerHTML="";
  let total=0;
  let text="Like STar nail 消費明細\n\n";

  ["基礎款","單指加價","卸甲","扣除項目"].forEach(g=>{
    app.innerHTML+=`<div class="section"><h3>${g}</h3></div>`;
    const sec=app.lastChild;

    items.filter(i=>i.group===g).forEach((i)=>{
      sec.innerHTML+=`
      <div class="item">
        <span class="name">${i.name} (${i.price>0?"$"+i.price:"-$"+Math.abs(i.price)})</span>
        <button onclick="chg('${i.name}',-1)">-</button>
        <span class="qty">${i.qty}</span>
        <button onclick="chg('${i.name}',1)">+</button>
      </div>`;
      if(i.qty>0){
        total+=i.qty*i.price;
        text+=`${i.name} × ${i.qty}  $${i.qty*i.price}\n`;
      }
    });
  });

  const dep=+deposit.value;
  if(dep){ total-=dep; text+=`\n已扣訂金 -$${dep}\n`; }

  if(note.value.trim()) text+=`\n備註：\n${note.value}\n`;
  text+=`\n應付金額：$${total}`;
  detail.innerText=text;

  items.forEach((i,idx)=>{
    admin.innerHTML+=`
    <div class="admin-item" draggable="true" data-i="${idx}">
      <input value="${i.name}" onchange="i.name=this.value">
      <input type="number" value="${i.price}" onchange="i.price=this.value">
      <span class="small">${i.group}</span>
    </div>`;
  });

  dragInit();
}

function chg(name,n){
  const i=items.find(x=>x.name===name);
  i.qty=Math.max(0,i.qty+n);
  render();
}

function addItem(){
  items.push({
    name:newName.value,
    price:+newPrice.value,
    group:newGroup.value,
    qty:0
  });
  newName.value=newPrice.value="";
  render();
}

function dragInit(){
  let drag;
  document.querySelectorAll(".admin-item").forEach(el=>{
    el.ondragstart=()=>{drag=el;el.classList.add("dragging");}
    el.ondragend=()=>el.classList.remove("dragging");
    el.ondragover=e=>e.preventDefault();
    el.ondrop=()=>{
      const a=+drag.dataset.i,b=+el.dataset.i;
      items.splice(b,0,items.splice(a,1)[0]);
      render();
    }
  });
}

function sendLine(){
  window.open("https://line.me/R/msg/text/?"+encodeURIComponent(detail.innerText));
}

render();
</script>

</body>
</html>